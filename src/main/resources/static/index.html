<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>三日月フブキ动画管理端</title>
    <link rel="shortcut icon" href="minlogo.ico">
    <!-- 引入样式 -->
    <link rel="stylesheet" href="plugins/element-ui/index.css" />
    <link rel="stylesheet" href="styles/common.css" />
    <link rel="stylesheet" href="styles/index.css" />
    <link rel="stylesheet" href="styles/icon/iconfont.css" />
    <style>
      .body{
        min-width: 1366px;
      }
      .app-main{
        height: calc(100% - 64px);
      }
      .app-main .divTmp{
        width: 100%;
        height: 100%;
      }
    </style>
  </head>

  <body>
    <div class="app" id="app">
      <div class="app-wrapper openSidebar clearfix">
        <!-- sidebar -->
        <div class="sidebar-container">
          <div class="logo">
            <!-- <img src="images/logo.png" width="122.5" alt="" /> -->
            <img src="images/login/Mainlogo.png" alt="" style="width: 182px; height: 58px" />
          </div>

          <el-scrollbar wrap-class="scrollbar-wrapper">
            <el-menu
              :default-active="defAct"
              :unique-opened="false"
              :collapse-transition="false"

              background-color="#fdf6fd"
              text-color="#fffffc"
              active-text-color="#ffadad"
            >
              <div v-for="item in menuList" :key="item.id">
                <el-submenu :index="item.id" v-if="item.children && item.children.length>0">
                  <template slot="title">
                    <i class="iconfont" :class="item.icon"></i>
                    <span>{{item.name}}</span>
                  </template>
                  <el-menu-item
                    v-for="sub in item.children"
                    :index="sub.id"
                    :key="sub.id"
                    @click="menuHandle(sub,false)"
                    >
                    <i :class="iconfont" :class="sub.icon"></i>
                    <span slot="title">{{sub.name}}</span>
                    </el-menu-item
                  >
                </el-submenu>
                <el-menu-item v-else :index="item.id" @click="menuHandle(item,false)">
                  <i class="iconfont" :class="item.icon"></i>
                  <span slot="title">{{item.name}}</span>
                </el-menu-item>
              </div>
            </el-menu>
          </el-scrollbar>
        </div>
        <div class="main-container">
          <!-- <navbar /> -->
          <div class="navbar">
              <div class="hamburger-container" id="sidebarToggle">
                  <i id="toggleIcon" class="el-icon-arrow-left"></i> <!-- 初始设置为右箭头 -->
              </div>
            <div class="head-lable">
              <span v-if="goBackFlag" class="goBack" @click="goBack()"
                ><img src="images/icons/btn_back@2x.png" alt="" /> 返回</span
              >
              <span>{{headTitle}}</span>
            </div>
            <div class="right-menu">
              <div class="avatar-wrapper">{{ userInfo.name }}</div>
              <!-- <div class="logout" @click="logout">退出</div> -->
              <img src="images/icons/btn_close@2x.png" class="outLogin" alt="退出" @click="logout()" />
            </div>

          </div>
          <div class="app-main" v-loading="loading">
            <div class="divTmp" v-show="loading"></div>
            <iframe
              id="cIframe"
              class="c_iframe"
              name="cIframe"
              :src="iframeUrl"
              width="100%"
              height="auto"
              frameborder="0"
              v-show="!loading"
            ></iframe>
          </div>
        </div>
      </div>
    </div>
    <!-- 开发环境版本，包含了有帮助的命令行警告 -->
    <script src="plugins/vue/vue.js"></script>
    <!-- 引入组件库 -->
    <script src="plugins/element-ui/index.js"></script>
    <!-- 引入axios -->
    <script src="plugins/axios/axios.min.js"></script>
    <script src="js/request.js"></script>
    <script src="./api/login.js"></script>
    <script>

        document.addEventListener('DOMContentLoaded', function () {
            var sidebarToggle = document.getElementById('sidebarToggle');
            var appWrapper = document.querySelector('.app-wrapper');
            var toggleIcon = document.getElementById('toggleIcon');

            sidebarToggle.addEventListener('click', function() {
                appWrapper.classList.toggle('openSidebar');

                // 根据侧边栏状态切换图标
                if (appWrapper.classList.contains('openSidebar')) {
                    toggleIcon.classList.remove('el-icon-arrow-right');
                    toggleIcon.classList.add('el-icon-arrow-left');
                } else {
                    toggleIcon.classList.remove('el-icon-arrow-left');
                    toggleIcon.classList.add('el-icon-arrow-right');
                }
            });
        });


      new Vue({
        el: '#app',
        data() {
          return {
            defAct: '2',
            menuActived: '2',
            userInfo: {},
            menuList: [
              {
                id: '1',
                name: 'SHOW',
                children: [
                  {
                    id: '1-1',
                    name: '统计表',
                    url: 'pages/show5/index.html',
                      icon: 'icon-member'
                  },
                  {
                    id: '1-2',
                    name: '主表',
                    url: 'pages/mainShows.html',
                    icon: 'icon-category'
                  },
                    {
                        id: '1-3',
                        name: '追番季',
                        url: 'pages/quarter7/index.html',
                        icon: 'icon-category'
                    },
                    {
                        id: '1-4',
                        name: '追番时期',
                        url: 'pages/period6/index.html',
                        icon: 'icon-category'
                    },
                    {
                        id: '1-5',
                        name: '最爱女主排名',
                        url: 'pages/favoriteGirlRanks.html',
                        icon: 'icon-category'
                    },


                ],
              },
                {
                    id: '2',
                    name: 'Anime',
                    children: [
                        {
                            id: '2-1',
                            name: '主表',
                            url: 'pages/mainManages.html',
                            icon: 'icon-category'
                        },
                        {
                            id: '2-2',
                            name: '追番季',
                            url: 'pages/quarters.html',
                            icon: 'icon-category'
                        },
                        {
                            id: '2-3',
                            name: '时期点',
                            url: 'pages/periods.html',
                            icon: 'icon-category'
                        },
                        {
                            id: '2-4',
                            name: '版本',
                            url: 'pages/editions.html',
                            icon: 'icon-category'
                        },
                        {
                            id: '2-5',
                            name: '动画来源',
                            url: 'pages/sources.html',
                            icon: 'icon-order'
                        },
                        {
                            id: '2-6',
                            name: '形式类型',
                            url: 'pages/layoutTypes.html',
                            icon: 'icon-order'
                        },
                        {
                            id: '2-7',
                            name: '动画类型',
                            url: 'pages/types.html',
                            icon: 'icon-order'
                        },
                        {
                            id: '2-8',
                            name: '恋爱类型',
                            url: 'pages/loves.html',
                            icon: 'icon-order'
                        },
                        {
                            id: '2-9',
                            name: '工口类型',
                            url: 'pages/sexLimits.html',
                            icon: 'icon-order'
                        },
                        {
                            id: '2-10',
                            name: '创作类型',
                            url: 'pages/creates.html',
                            icon: 'icon-order'
                        },
                        {
                            id: '2-11',
                            name: '主角类型',
                            url: 'pages/leaderGenders.html',
                            icon: 'icon-order'
                        },
                        {
                            id: '2-12',
                            name: '动画结局',
                            url: 'pages/animationEnds.html',
                            icon: 'icon-order'
                        },
                        {
                            id: '2-13',
                            name: '原作结局',
                            url: 'pages/originalEnds.html',
                            icon: 'icon-order'
                        },
                        {
                            id: '2-14',
                            name: '追番类型',
                            url: 'pages/bingeWatchingTypes.html',
                            icon: 'icon-order'
                        },
                        {
                            id: '2-15',
                            name: '动画周边',
                            url: 'pages/merchs.html',
                            icon: 'icon-order'
                        },

                    ],
                },
                {
                    id: '3',
                    name: 'CV',
                    children: [
                        {
                            id: '3-1',
                            name: '声优信息',
                            url: 'pages/cvCVs.html',
                            icon: 'icon-order'
                        },
                        {
                            id: '3-2',
                            name: '声优作品',
                            url: 'pages/cvWorks.html',
                            icon: 'icon-order'
                        },
                        {
                            id: '3-3',
                            name: '已故声优',
                            url: 'pages/cvDeaths.html',
                            icon: 'icon-order'
                        },
                    ],
                },
                {
                    id: '4',
                    name: 'GalGame',
                    children: [
                        {
                            id: '4-1',
                            name: 'GalGame',
                            url: 'pages/galgames.html',
                            icon: 'icon-order'
                        },
                        {
                            id: '4-2',
                            name: '环境类型',
                            url: 'pages/ggEnvTypes.html',
                            icon: 'icon-order'
                        },
                      {
                        id: '4-3',
                        name: '剧情类型',
                        url: 'pages/ggTypes.html',
                        icon: 'icon-order'
                      },
                      {
                        id: '4-4',
                        name: '轮回类型',
                        url: 'pages/ggRebornTypes.html',
                        icon: 'icon-order'
                      },
                      {
                        id: '4-5',
                        name: '恋爱类型',
                        url: 'pages/ggLoveTypes.html',
                        icon: 'icon-order'
                      },
                      {
                        id: '4-6',
                        name: '分支类型',
                        url: 'pages/ggBranchTypes.html',
                        icon: 'icon-order'
                      },
                      {
                        id: '4-7',
                        name: '特殊类型',
                        url: 'pages/ggSpTypes.html',
                        icon: 'icon-order'
                      },
                    ],
                },
                {
                    id: '5',
                    name: 'AniSong',
                    children: [
                        {
                            id: '5-1',
                            name: '音乐',
                            url: 'pages/musics.html',
                            icon: 'icon-order'
                        },
                        {
                            id: '5-2',
                            name: '音乐类型',
                            url: 'pages/mTypes.html',
                            icon: 'icon-order'
                        },
                        {
                            id: '5-3',
                            name: '下载类型',
                            url: 'pages/mDTypes.html',
                            icon: 'icon-order'
                        },
                        {
                            id: '5-4',
                            name: '添加类型',
                            url: 'pages/mATypes.html',
                            icon: 'icon-order'
                        },
                        {
                            id: '5-5',
                            name: '版本',
                            url: 'pages/mEditions.html',
                            icon: 'icon-order'
                        },
                    ],
                },
                {
                    id: '6',
                    name: 'Comic&HAnime',
                    children: [
                        {
                            id: '6-1',
                            name: '里番',
                            url: 'pages/hanimes.html',
                            icon: 'icon-order'
                        },
                        {
                            id: '6-2',
                            name: 'H漫类型',
                            url: 'pages/htypes.html',
                            icon: 'icon-order'
                        },
                        {
                            id: '6-3',
                            name: '漫画',
                            url: 'pages/comics.html',
                            icon: 'icon-order'
                        },
                    ],
                },
            ],
            iframeUrl: 'pages/show5/index.html',
            headTitle: '统计展示',
            goBackFlag: false,
            loading: true,
            timer: null
          }
        },
        computed: {},
        created() {
          const userInfo = window.localStorage.getItem('userInfo')
          if (userInfo) {
            this.userInfo = JSON.parse(userInfo)
          }
          this.closeLoading()
        },
        beforeDestroy() {
          this.timer = null
          clearTimeout(this.timer)
        },
        mounted() {
          window.menuHandle = this.menuHandle
        },
        methods: {
          logout() {
              this.$confirm("是否退出系统？", "提示", {type: "info"}).then(() => {
                axios.post("/user/logout").then((res)=>{
                  if(res.data.flag){
                    localStorage.removeItem('userInfo')
                    window.location.href = '/pages/login.html'
                  }
                })
              }).catch(() => {
                  this.$message.info("取消操作");
              });
          },

          goBack() {
            // window.location.href = 'javascript:history.go(-1)'
            const menu = this.menuList.find(item=>item.id===this.menuActived)
            // this.goBackFlag = false
            // this.headTitle = menu.name
            this.menuHandle(menu,false)
          },
          menuHandle(item, goBackFlag) {
            this.loading = true
            this.menuActived = item.id
            this.iframeUrl = item.url
            this.headTitle = item.name
            this.goBackFlag = goBackFlag
            this.closeLoading()
          },
          closeLoading(){
            this.timer = null
            this.timer = setTimeout(()=>{
              this.loading = false
            },1000)
          }
        }
      })
    </script>
  </body>
</html>
